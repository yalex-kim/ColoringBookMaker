<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¬ëŸ¬ë§ë¶ ë©”ì´ì»¤ - ë‹¨ìˆœ ë²„ì „</title>
    <link rel="stylesheet" href="./styles/main.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ì»¬ëŸ¬ë§ë¶ ë©”ì´ì»¤</h1>
            <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì—¬ ì»¬ëŸ¬ë§ë¶ìœ¼ë¡œ ë³€í™˜í•´ë³´ì„¸ìš”!</p>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ -->
        <div class="upload-section">
            <div class="upload-box" id="uploadBox">
                <div class="upload-icon">ğŸ“</div>
                <h3>ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ</h3>
                <p>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•´ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                <p class="file-info">ì§€ì› í˜•ì‹: JPG, PNG, GIF, WEBP</p>
                <input type="file" id="fileInput" accept="image/*" hidden>
            </div>
        </div>

        <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
        <div id="previewSection" class="preview-section" style="display: none;">
            <h3>ì›ë³¸ ì´ë¯¸ì§€</h3>
            <div class="image-container">
                <img id="previewImage" alt="ë¯¸ë¦¬ë³´ê¸°">
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ -->
        <div id="controlsSection" class="controls-section" style="display: none;">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="threshold">ìœ¤ê³½ì„  ë¯¼ê°ë„:</label>
                    <div class="slider-group">
                        <input type="range" id="threshold" min="50" max="200" value="128">
                        <span id="thresholdValue">128</span>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="processBtn" class="primary-btn">ì»¬ëŸ¬ë§ë¶ ë³€í™˜</button>
                <button id="resetBtn" class="secondary-btn">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- ê²°ê³¼ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h3>ì»¬ëŸ¬ë§ë¶ ê²°ê³¼</h3>
            <div class="image-container">
                <canvas id="resultCanvas"></canvas>
            </div>
            <button id="downloadBtn" class="primary-btn">ë‹¤ìš´ë¡œë“œ</button>
        </div>
    </div>

    <script>
        console.log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
        
        let currentImage = null;
        
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            initApp();
        });
        
        function initApp() {
            const fileInput = document.getElementById('fileInput');
            const uploadBox = document.getElementById('uploadBox');
            const processBtn = document.getElementById('processBtn');
            const resetBtn = document.getElementById('resetBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸
            uploadBox.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸
            processBtn.addEventListener('click', processImage);
            resetBtn.addEventListener('click', resetApp);
            downloadBtn.addEventListener('click', downloadResult);
            
            // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
            const threshold = document.getElementById('threshold');
            const thresholdValue = document.getElementById('thresholdValue');
            threshold.addEventListener('input', function() {
                thresholdValue.textContent = this.value;
            });
            
            console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ');
        }
        
        function handleFile(file) {
            console.log('íŒŒì¼ ì²˜ë¦¬:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    showPreview(img);
                    showControls();
                    console.log('ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function showPreview(img) {
            const previewSection = document.getElementById('previewSection');
            const previewImage = document.getElementById('previewImage');
            
            previewImage.src = img.src;
            previewSection.style.display = 'block';
        }
        
        function showControls() {
            document.getElementById('controlsSection').style.display = 'block';
        }
        
        function processImage() {
            if (!currentImage) {
                alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘');
            
            // ê°„ë‹¨í•œ ì²˜ë¦¬ (í‘ë°± ë³€í™˜)
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = currentImage.width;
            canvas.height = currentImage.height;
            
            ctx.drawImage(currentImage, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            // ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜
            for (let i = 0; i < data.length; i += 4) {
                const gray = Math.round(0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]);
                data[i] = gray;
                data[i + 1] = gray;
                data[i + 2] = gray;
            }
            
            ctx.putImageData(imageData, 0, 0);
            showResult(canvas);
            
            console.log('ì´ë¯¸ì§€ ì²˜ë¦¬ ì™„ë£Œ');
        }
        
        function showResult(canvas) {
            const resultSection = document.getElementById('resultSection');
            const resultCanvas = document.getElementById('resultCanvas');
            
            resultCanvas.width = canvas.width;
            resultCanvas.height = canvas.height;
            const ctx = resultCanvas.getContext('2d');
            ctx.drawImage(canvas, 0, 0);
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function resetApp() {
            currentImage = null;
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('controlsSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('fileInput').value = '';
            console.log('ì•± ë¦¬ì…‹ ì™„ë£Œ');
        }
        
        function downloadResult() {
            const canvas = document.getElementById('resultCanvas');
            if (!canvas) return;
            
            const link = document.createElement('a');
            link.download = `coloring-book-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            console.log('ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
        }
        
        // ì—ëŸ¬ ê°ì§€
        window.addEventListener('error', function(e) {
            console.error('ì—ëŸ¬ ë°œìƒ:', e.error);
        });
        
        console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>