<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¬ëŸ¬ë§ë¶ ë©”ì´ì»¤ - AI ì´ë¯¸ì§€ ìƒì„± í¬í•¨</title>
    <link rel="stylesheet" href="./styles/main.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ì»¬ëŸ¬ë§ë¶ ë©”ì´ì»¤</h1>
            <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ì›¹ì—ì„œ ìˆ˜ì§‘í•˜ê±°ë‚˜ Gemini AIë¡œ ìµœì í™”í•˜ì—¬ ì»¬ëŸ¬ë§ë¶ìœ¼ë¡œ ë³€í™˜í•´ë³´ì„¸ìš”!</p>
        </div>

        <!-- ëª¨ë“œ ì„ íƒ íƒ­ -->
        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="upload">
                ğŸ“ íŒŒì¼ ì—…ë¡œë“œ
            </button>
            <button class="mode-tab" data-mode="web">
                ğŸŒ ì›¹ ì´ë¯¸ì§€ ìˆ˜ì§‘
            </button>
            <button class="mode-tab" data-mode="ai">
                ğŸ¤– Gemini AI ìƒì„±
            </button>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ëª¨ë“œ -->
        <div id="upload-mode" class="mode-content active">
            <div class="upload-section">
                <div class="upload-box" id="uploadBox">
                    <div class="upload-icon">ğŸ“</div>
                    <h3>ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ</h3>
                    <p>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•´ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                    <p class="file-info">ì§€ì› í˜•ì‹: JPG, PNG, GIF, WEBP</p>
                    <input type="file" id="fileInput" accept="image/*" hidden>
                </div>
            </div>
        </div>

        <!-- ì›¹ ì´ë¯¸ì§€ ìˆ˜ì§‘ ëª¨ë“œ -->
        <div id="web-mode" class="mode-content">
            <div class="web-section">
                <div class="input-group">
                    <input type="url" id="imageUrl" placeholder="ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”...">
                    <button id="loadImageBtn" class="primary-btn">ì´ë¯¸ì§€ ë¡œë“œ</button>
                </div>
                <div class="url-info">
                    <p>ğŸ’¡ <strong>ì‚¬ìš© íŒ:</strong></p>
                    <ul>
                        <li>ì§ì ‘ ì´ë¯¸ì§€ ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (jpg, png, gif, webp)</li>
                        <li>ì´ë¯¸ì§€ ë¡œë“œì— ì‹¤íŒ¨í•˜ë©´ <strong>íŒŒì¼ ì—…ë¡œë“œ ëª¨ë“œ</strong>ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.</li>
                    </ul>
                    
                    <div style="margin-top: 20px;">
                        <p style="font-weight: bold; margin-bottom: 10px;">ğŸ”— ì˜ˆì‹œ ì´ë¯¸ì§€ URL:</p>
                        <div class="example-urls">
                            <span class="example-url" onclick="setExampleUrl('https://pokemonkorea.co.kr/pokedex')">Pokemon Korea</span>
                            <span class="example-url" onclick="setExampleUrl('https://picsum.photos')">Picsum Photos</span>
                            <span class="example-url" onclick="setExampleUrl('https://unsplash.com')">Unsplash</span>
                            <span class="example-url" onclick="setExampleUrl('https://pixabay.com')">Pixabay</span>
                            <span class="example-url" onclick="setExampleUrl('https://pexels.com')">Pexels</span>
                        </div>
                        
                        <p style="font-size: 0.9em; color: #888; margin-top: 10px;">
                            âš ï¸ ì¼ë¶€ ì‚¬ì´íŠ¸ëŠ” CORS ì •ì±…ìœ¼ë¡œ ì¸í•´ ë¡œë“œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                </div>

                <!-- ì›¹ ì´ë¯¸ì§€ ì‘ì—… ê³µê°„ (ê°¤ëŸ¬ë¦¬ + ë¯¸ë¦¬ë³´ê¸°) -->
                <div id="webWorkspace" class="web-workspace" style="display: none;">
                    <div class="workspace-container">
                        <!-- ì™¼ìª½: ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ (1/3) -->
                        <div class="gallery-panel">
                            <div class="gallery-header">
                                <h3>ğŸ–¼ï¸ ë°œê²¬ëœ ì´ë¯¸ì§€ë“¤</h3>
                                <p id="imageCount" style="color: #888; font-size: 0.9em; margin-bottom: 8px;">ë¡œë”© ì¤‘...</p>
                                <p style="color: #666; margin: 0; font-size: 0.9em;">ì›í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                            </div>
                            <div class="gallery-scrollable">
                                <div id="imageGrid" class="image-grid-compact"></div>
                                <div id="galleryLoading" class="gallery-loading" style="display: none;">
                                    <div class="spinner"></div>
                                    <p>ì´ë¯¸ì§€ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¤‘...</p>
                                </div>
                            </div>
                        </div>

                        <!-- ì˜¤ë¥¸ìª½: ì„ íƒëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ë° ë³€í™˜ (2/3) -->
                        <div class="preview-panel">
                            <!-- ë¡œë”© ìƒíƒœ í‘œì‹œ -->
                            <div id="imageLoadingStatus" class="loading-status" style="display: none;">
                                <div class="loading-content">
                                    <div class="spinner-small"></div>
                                    <h3>ğŸ”„ ì´ë¯¸ì§€ ë¡œë”© ì¤‘...</h3>
                                    <p>ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                                </div>
                            </div>

                            <div id="selectedImagePreview" class="selected-preview" style="display: none;">
                                <h3>ğŸ“· ì„ íƒëœ ì´ë¯¸ì§€</h3>
                                <div class="image-display">
                                    <img id="selectedImage" alt="ì„ íƒëœ ì´ë¯¸ì§€">
                                </div>
                            </div>

                            <!-- ì›¹ ì´ë¯¸ì§€ ì„¤ì • ì˜µì…˜ -->
                            <div id="webControlsSection" class="web-controls-section" style="display: none;">
                                <h3>âš™ï¸ ë³€í™˜ ì„¤ì •</h3>
                                <div class="controls-grid-compact">
                                    <div class="control-group">
                                        <label for="webThreshold">ìœ¤ê³½ì„  ë¯¼ê°ë„:</label>
                                        <div class="slider-group">
                                            <input type="range" id="webThreshold" min="50" max="200" value="128">
                                            <span id="webThresholdValue">128</span>
                                        </div>
                                    </div>
                                    
                                    <div class="control-group">
                                        <label for="webLineWidth">ì„  êµµê¸°:</label>
                                        <div class="slider-group">
                                            <input type="range" id="webLineWidth" min="1" max="5" value="1">
                                            <span id="webLineWidthValue">1</span>
                                        </div>
                                    </div>
                                    
                                    <div class="control-group">
                                        <label for="webPaperSize">ğŸ“„ ì¢…ì´ ì‚¬ì´ì¦ˆ:</label>
                                        <select id="webPaperSize">
                                            <option value="a4">A4 (210Ã—297mm)</option>
                                            <option value="a5">A5 (148Ã—210mm)</option>
                                            <option value="b4">B4 (250Ã—353mm)</option>
                                            <option value="b5">B5 (176Ã—250mm)</option>
                                            <option value="5x7">5Ã—7 ì¸í™”ìš© (5Ã—7")</option>
                                            <option value="4x6">4Ã—6 ì¸í™”ìš© (4Ã—6")</option>
                                        </select>
                                    </div>
                                    
                                    <div class="control-group">
                                        <label for="webOrientation">ğŸ”„ ë°©í–¥:</label>
                                        <select id="webOrientation">
                                            <option value="portrait">ì„¸ë¡œ (Portrait)</option>
                                            <option value="landscape">ê°€ë¡œ (Landscape)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="control-group">
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="webIncludeGuide" checked>
                                            <label for="webIncludeGuide">ğŸŒˆ ìƒ‰ì¹  ê°€ì´ë“œ í¬í•¨</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="web-action-buttons">
                                    <button id="webProcessBtn" class="primary-btn">ğŸ¨ ì»¬ëŸ¬ë§ë¶ ë³€í™˜</button>
                                </div>
                            </div>
                            
                            <div id="convertedImageResult" class="converted-result" style="display: none;">
                                <h3>ğŸ¨ ë³€í™˜ëœ ì»¬ëŸ¬ë§ë¶</h3>
                                <div class="image-display">
                                    <canvas id="convertedCanvas"></canvas>
                                </div>
                                <div class="result-actions">
                                    <button id="downloadBtn" class="primary-btn">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI ì´ë¯¸ì§€ ìƒì„± ëª¨ë“œ -->
        <div id="ai-mode" class="mode-content">
            <div class="ai-section">
                <div class="prompt-section">
                    <h3>ğŸ¤– AI ì´ë¯¸ì§€ ìƒì„±</h3>
                    <div class="features-info">
                        <p><strong>ğŸ¤– Gemini AI ê°•í™” ê¸°ëŠ¥:</strong></p>
                        <ul>
                            <li><strong>ìŠ¤ë§ˆíŠ¸ í”„ë¡¬í”„íŠ¸ ê°œì„ :</strong> ë‹¨ì–´ ëª‡ ê°œë§Œ ì…ë ¥í•´ë„ ìë™ìœ¼ë¡œ ìµœì í™”ëœ í”„ë¡¬í”„íŠ¸ë¡œ ë³€í™˜</li>
                            <li><strong>ì»¬ëŸ¬ë§ë¶ íŠ¹í™”:</strong> ì»¬ëŸ¬ë§ë¶ì— ì í•©í•œ ì„ ëª…í•œ ìœ¤ê³½ì„ ê³¼ ë‹¨ìˆœí•œ êµ¬ì¡°ë¡œ ìƒì„±</li>
                            <li><strong>ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼:</strong> ë™ë¬¼, ì‹ë¬¼, ê±´ë¬¼, ìºë¦­í„° ë“± ë‹¤ì–‘í•œ ì£¼ì œ ì§€ì›</li>
                        </ul>
                    </div>
                    
                    <div class="input-group">
                        <textarea id="promptInput" placeholder="ì–´ë–¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ì‹¶ë‚˜ìš”? (ì˜ˆ: ê·€ì—¬ìš´ ê³ ì–‘ì´, ì„±, ê½ƒ)" rows="3"></textarea>
                        <div class="prompt-controls">
                            <button id="improvePromptBtn" class="secondary-btn">í”„ë¡¬í”„íŠ¸ ê°œì„ </button>
                            <button id="generateBtn" class="primary-btn">ì´ë¯¸ì§€ ìƒì„±</button>
                        </div>
                    </div>
                    
                    <div class="example-prompts">
                        <p><strong>ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸:</strong></p>
                        <div class="prompt-examples">
                            <span class="example-prompt" data-prompt="ê·€ì—¬ìš´ ê°•ì•„ì§€">ê·€ì—¬ìš´ ê°•ì•„ì§€</span>
                            <span class="example-prompt" data-prompt="ë§ˆë²•ì˜ ì„±">ë§ˆë²•ì˜ ì„±</span>
                            <span class="example-prompt" data-prompt="ì˜ˆìœ ê½ƒ">ì˜ˆìœ ê½ƒ</span>
                            <span class="example-prompt" data-prompt="ìš°ì£¼ ë¡œì¼“">ìš°ì£¼ ë¡œì¼“</span>
                        </div>
                    </div>
                </div>

                <!-- AI ì´ë¯¸ì§€ ê²°ê³¼ -->
                <div id="aiResults" class="ai-results" style="display: none;">
                    <h3>ìƒì„±ëœ ì´ë¯¸ì§€</h3>
                    <div class="generated-images" id="generatedImages"></div>
                </div>
            </div>
        </div>

        <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
        <div id="previewSection" class="preview-section" style="display: none;">
            <h3>ì›ë³¸ ì´ë¯¸ì§€</h3>
            <div class="image-container">
                <img id="previewImage" alt="ë¯¸ë¦¬ë³´ê¸°">
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
        <div id="controlsSection" class="controls-section" style="display: none;">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="threshold">ìœ¤ê³½ì„  ë¯¼ê°ë„:</label>
                    <div class="slider-group">
                        <input type="range" id="threshold" min="50" max="200" value="128">
                        <span id="thresholdValue">128</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="lineWidth">ì„  êµµê¸°:</label>
                    <div class="slider-group">
                        <input type="range" id="lineWidth" min="1" max="5" value="1">
                        <span id="lineWidthValue">1</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="paperSize">ğŸ“„ ì¢…ì´ ì‚¬ì´ì¦ˆ:</label>
                    <select id="paperSize">
                        <option value="a4">A4 (210Ã—297mm)</option>
                        <option value="a5">A5 (148Ã—210mm)</option>
                        <option value="b4">B4 (250Ã—353mm)</option>
                        <option value="b5">B5 (176Ã—250mm)</option>
                        <option value="5x7">5Ã—7 ì¸í™”ìš© (5Ã—7")</option>
                        <option value="4x6">4Ã—6 ì¸í™”ìš© (4Ã—6")</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="orientation">ğŸ”„ ë°©í–¥:</label>
                    <select id="orientation">
                        <option value="portrait">ì„¸ë¡œ (Portrait)</option>
                        <option value="landscape">ê°€ë¡œ (Landscape)</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="includeGuide" checked>
                        <label for="includeGuide">ğŸŒˆ ìƒ‰ì¹  ê°€ì´ë“œ í¬í•¨</label>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="processBtn" class="primary-btn">ì»¬ëŸ¬ë§ë¶ ë³€í™˜</button>
                <button id="resetBtn" class="secondary-btn">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h3>ì»¬ëŸ¬ë§ë¶ ê²°ê³¼</h3>
            <div class="image-container">
                <canvas id="resultCanvas"></canvas>
            </div>
            <button id="downloadBtn" class="primary-btn">ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <!-- ë¡œë”© í‘œì‹œ -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <p id="loadingText">ì²˜ë¦¬ ì¤‘...</p>
            </div>
        </div>
    </div>

    <script>
        // ì¢…ì´ ì‚¬ì´ì¦ˆ ì •ì˜ (72DPI ê¸°ì¤€)
        const paperSizes = {
            a4: { width: 595, height: 842, name: 'A4' },
            a5: { width: 420, height: 595, name: 'A5' },
            b4: { width: 708, height: 1001, name: 'B4' },
            b5: { width: 499, height: 708, name: 'B5' },
            '5x7': { width: 360, height: 504, name: '5Ã—7' },
            '4x6': { width: 288, height: 432, name: '4Ã—6' }
        };

        let currentImage = null;

        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            setupEventListeners();
            setupSliders();
            console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ');
        }

        function setupEventListeners() {
            // ëª¨ë“œ íƒ­ ì „í™˜
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchMode(this.dataset.mode);
                });
            });

            // íŒŒì¼ ì—…ë¡œë“œ
            document.getElementById('uploadBox').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });

            document.getElementById('fileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) handleFile(file);
            });

            // ì›¹ ì´ë¯¸ì§€ ë¡œë“œ
            document.getElementById('loadImageBtn').addEventListener('click', loadWebImage);
            
            // Enter í‚¤ë¡œ ì›¹ ì´ë¯¸ì§€ ë¡œë“œ
            document.getElementById('imageUrl').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadWebImage();
                }
            });

            // ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('processBtn').addEventListener('click', processImage);
            document.getElementById('resetBtn').addEventListener('click', resetApp);
            document.getElementById('downloadBtn').addEventListener('click', downloadResult);
            
            // ì›¹ ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸
            const webProcessBtn = document.getElementById('webProcessBtn');
            if (webProcessBtn) {
                webProcessBtn.addEventListener('click', processWebImage);
            }
        }

        function switchMode(mode) {
            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            // ì»¨í…ì¸  ì „í™˜
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${mode}-mode`).classList.add('active');

            // ëª¨ë“  UI ìƒíƒœ ì´ˆê¸°í™”
            resetAllUIStates();

            console.log(`ëª¨ë“œ ì „í™˜: ${mode}`);
        }

        function resetAllUIStates() {
            // í˜„ì¬ ì´ë¯¸ì§€ ì´ˆê¸°í™”
            currentImage = null;
            
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const sectionsToHide = [
                'previewSection',
                'controlsSection', 
                'resultSection',
                'webWorkspace',
                'selectedImagePreview',
                'webControlsSection',
                'convertedImageResult',
                'imageLoadingStatus',
                'aiResults'
            ];
            
            sectionsToHide.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = 'none';
                }
            });

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.value = '';
            }
            
            const imageUrl = document.getElementById('imageUrl');
            if (imageUrl) {
                imageUrl.value = '';
            }
            
            const promptInput = document.getElementById('promptInput');
            if (promptInput) {
                promptInput.value = '';
            }

            // ì›¹ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ì´ˆê¸°í™”
            const imageGrid = document.getElementById('imageGrid');
            if (imageGrid) {
                imageGrid.innerHTML = '';
            }

            // ìƒì„±ëœ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ì´ˆê¸°í™”
            const generatedImages = document.getElementById('generatedImages');
            if (generatedImages) {
                generatedImages.innerHTML = '';
            }

            console.log('ëª¨ë“  UI ìƒíƒœ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        function setExampleUrl(url) {
            document.getElementById('imageUrl').value = url;
            console.log('ì˜ˆì‹œ URL ì„¤ì •:', url);
        }

        function loadWebImage() {
            const url = document.getElementById('imageUrl').value.trim();
            if (!url) {
                alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('ì›¹ í˜ì´ì§€ ë¡œë“œ ì‹œì‘:', url);

            // URLì´ ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸
            if (isImageUrl(url)) {
                loadDirectImage(url);
            } else {
                scrapeWebPage(url);
            }
        }

        function isImageUrl(url) {
            const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.svg'];
            const lowercaseUrl = url.toLowerCase();
            return imageExtensions.some(ext => 
                lowercaseUrl.includes(ext) && 
                (lowercaseUrl.endsWith(ext) || lowercaseUrl.includes(ext + '?'))
            );
        }

        function loadDirectImage(url) {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                currentImage = img;
                showPreview(img);
                showControls();
                console.log('ì§ì ‘ ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ');
            };
            
            img.onerror = function() {
                alert('ì´ë¯¸ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                console.error('ì§ì ‘ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', url);
            };
            
            img.src = url;
        }

        async function scrapeWebPage(url) {
            const galleryLoading = document.getElementById('galleryLoading');
            const imageGrid = document.getElementById('imageGrid');

            // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í‘œì‹œ ë° ë¡œë”© í‘œì‹œ
            showWebWorkspace();
            if (galleryLoading) {
                galleryLoading.style.display = 'block';
            }
            imageGrid.innerHTML = '';

            // íŠ¹ì • ì‚¬ì´íŠ¸ì˜ ê²½ìš° ì§ì ‘ ì´ë¯¸ì§€ URL ì œê³µ
            if (url.includes('pokemonkorea.co.kr')) {
                showPokemonImages();
                return;
            }

            try {
                // ê¸°ì¡´ ì‚¬ì´íŠ¸ì™€ ë™ì¼í•œ ë°©ì‹ ì‚¬ìš©
                const proxyUrl = 'https://api.allorigins.win/get?url=';
                console.log('ì›¹í˜ì´ì§€ ë¡œë“œ ì‹œì‘:', proxyUrl + url);
                const response = await fetch(proxyUrl + encodeURIComponent(url));
                
                if (!response.ok) {
                    throw new Error('ì›¹ì‚¬ì´íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                const data = await response.json();
                const htmlContent = data.contents;
                
                // HTML íŒŒì‹±í•˜ì—¬ ì´ë¯¸ì§€ ì°¾ê¸° (ê¸°ì¡´ ì‚¬ì´íŠ¸ ë°©ì‹)
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                const imgElements = doc.querySelectorAll('img');
                
                const images = [];
                const baseUrlObj = new URL(url);
                const baseUrl = baseUrlObj.origin;
                
                for (let img of imgElements) {
                    let src = img.src || img.getAttribute('data-src') || img.getAttribute('data-lazy') || img.getAttribute('data-srcset');
                    
                    if (src) {
                        // data-srcset ì²˜ë¦¬ (ì²« ë²ˆì§¸ URLë§Œ ì‚¬ìš©)
                        if (src.includes(' ')) {
                            src = src.split(' ')[0];
                        }
                        
                        // ìƒëŒ€ ê²½ë¡œë¥¼ ì ˆëŒ€ ê²½ë¡œë¡œ ë³€í™˜
                        if (src.startsWith('//')) {
                            src = 'https:' + src;
                        } else if (src.startsWith('/')) {
                            src = baseUrl + src;
                        } else if (!src.startsWith('http')) {
                            src = baseUrl + '/' + src;
                        }
                        
                        // ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸í•˜ê³  ì¤‘ë³µ ì œê±° (50ê°œ ì œí•œ)
                        if (isValidImageSrc(src) && !images.some(item => item.url === src) && images.length < 50) {
                            images.push({
                                url: src,
                                alt: img.alt || img.title || `ì´ë¯¸ì§€ ${images.length + 1}`
                            });
                        }
                    }
                }
                
                if (galleryLoading) {
                    if (galleryLoading) {
                galleryLoading.style.display = 'none';
            }
                }

                if (images.length === 0) {
                    imageGrid.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í‘œì‹œ ë° ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ë¡œë“œ
                showWebWorkspace();
                displayImageGallery(images); // 50ê°œë¡œ ì œí•œë¨
                console.log(`${images.length}ê°œì˜ ì´ë¯¸ì§€ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.`);

            } catch (error) {
                if (galleryLoading) {
                    if (galleryLoading) {
                galleryLoading.style.display = 'none';
            }
                }
                imageGrid.innerHTML = `
                    <div style="text-align: center; color: #f44336; padding: 20px;">
                        <h4>âŒ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨</h4>
                        <p>ì›¹ì‚¬ì´íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${error.message}</p>
                        <br>
                        <p><strong>ëŒ€ì•ˆ:</strong></p>
                        <button onclick="showSampleImages()" class="primary-btn" style="margin-top: 10px;">
                            ğŸ“· ìƒ˜í”Œ ì´ë¯¸ì§€ ë³´ê¸°
                        </button>
                    </div>
                `;
                console.error('ì›¹ ìŠ¤í¬ë˜í•‘ ì‹¤íŒ¨:', error);
            }
        }

        function isValidImageSrc(src) {
            if (!src || src.length < 10) return false;
            
            const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp'];
            const lowercaseSrc = src.toLowerCase();
            
            // ì´ë¯¸ì§€ í™•ì¥ì í™•ì¸
            const hasImageExt = imageExtensions.some(ext => 
                lowercaseSrc.includes(ext) && 
                (lowercaseSrc.endsWith(ext) || lowercaseSrc.includes(ext + '?'))
            );
            
            // ì‘ì€ ì•„ì´ì½˜ì´ë‚˜ ë¡œê³  ì œì™¸
            const isSmallIcon = lowercaseSrc.includes('icon') || 
                               lowercaseSrc.includes('logo') || 
                               lowercaseSrc.includes('favicon') ||
                               lowercaseSrc.includes('thumb') ||
                               src.includes('1x1') ||
                               src.includes('16x16') ||
                               src.includes('32x32');
            
            return hasImageExt && !isSmallIcon;
        }

        function showPokemonImages() {
            const galleryLoading = document.getElementById('galleryLoading');
            const imageGrid = document.getElementById('imageGrid');
            
            if (galleryLoading) {
                galleryLoading.style.display = 'none';
            }

            // í¬ì¼“ëª¬ 1~151 (1ì„¸ëŒ€ ì „ì²´) ë° ì¸ê¸° í¬ì¼“ëª¬ë“¤
            const pokemonData = [
                // 1ì„¸ëŒ€ ìŠ¤íƒ€í„° ì§„í™”ë¼ì¸
                { num: '001', name: 'ì´ìƒí•´ì”¨' }, { num: '002', name: 'ì´ìƒí•´í’€' }, { num: '003', name: 'ì´ìƒí•´ê½ƒ' },
                { num: '004', name: 'íŒŒì´ë¦¬' }, { num: '005', name: 'ë¦¬ìë“œ' }, { num: '006', name: 'ë¦¬ìëª½' },
                { num: '007', name: 'ê¼¬ë¶€ê¸°' }, { num: '008', name: 'ì–´ë‹ˆë¶€ê¸°' }, { num: '009', name: 'ê±°ë¶ì™•' },
                
                // ì¸ê¸° í¬ì¼“ëª¬ë“¤
                { num: '025', name: 'í”¼ì¹´ì¸„' }, { num: '026', name: 'ë¼ì´ì¸„' },
                { num: '039', name: 'í‘¸ë¦°' }, { num: '040', name: 'í‘¸í¬ë¦°' },
                { num: '052', name: 'ë‚˜ì˜¹ì´' }, { num: '053', name: 'í˜ë¥´ì‹œì˜¨' },
                { num: '054', name: 'ê³ ë¼íŒŒë•' }, { num: '055', name: 'ê³¨ë•' },
                { num: '104', name: 'í……êµ¬ë¦¬' }, { num: '105', name: 'í……êµ¬ë¦¬' },
                { num: '131', name: 'ë¼í”„ë¼ìŠ¤' }, { num: '143', name: 'ì ë§Œë³´' },
                
                // ì „ì„¤ì˜ í¬ì¼“ëª¬
                { num: '144', name: 'í”„ë¦¬ì ¸' }, { num: '145', name: 'ì¬ë”' }, { num: '146', name: 'íŒŒì´ì–´' },
                { num: '150', name: 'ë®¤ì¸ ' }, { num: '151', name: 'ë®¤' },
                
                // ê¸°íƒ€ ì¸ê¸° í¬ì¼“ëª¬ë“¤
                { num: '016', name: 'êµ¬êµ¬' }, { num: '017', name: 'í”¼ì£¤' }, { num: '018', name: 'í”¼ì£¤íˆ¬' },
                { num: '019', name: 'ê¼¬ë ›' }, { num: '020', name: 'ë ˆíŠ¸ë¼' },
                { num: '035', name: 'í”½ì‹œ' }, { num: '036', name: 'í”½ì‹œ' },
                { num: '037', name: 'ì‹ìŠ¤í…Œì¼' }, { num: '038', name: 'ë‚˜ì¸í…Œì¼' },
                { num: '058', name: 'ê°€ë””' }, { num: '059', name: 'ìœˆë””' },
                { num: '063', name: 'ìºì´ì‹œ' }, { num: '064', name: 'ìœ¤ê²”ë¼' }, { num: '065', name: 'í›„ë”˜' },
                { num: '066', name: 'ì•Œí†µëª¬' }, { num: '067', name: 'ê·¼ìœ¡ëª¬' }, { num: '068', name: 'ê´´ë ¥ëª¬' },
                { num: '074', name: 'ê¼¬ë§ˆëŒ' }, { num: '075', name: 'ë°êµ¬ë¦¬' }, { num: '076', name: 'ë”±êµ¬ë¦¬' },
                { num: '077', name: 'í¬ë‹ˆíƒ€' }, { num: '078', name: 'ë‚ ìŒ©ë§ˆ' },
                { num: '083', name: 'íŒŒì˜¤ë¦¬' }, { num: '084', name: 'ë‘ë‘' }, { num: '085', name: 'ë‘íŠ¸ë¦¬ì˜¤' },
                { num: '090', name: 'ì…€ëŸ¬' }, { num: '091', name: 'íŒŒë¥´ì…€' },
                { num: '092', name: 'ê³ ì˜¤ìŠ¤' }, { num: '093', name: 'ê³ ìš°ìŠ¤íŠ¸' }, { num: '094', name: 'íŒ¬í…€' },
                { num: '095', name: 'ë¡±ìŠ¤í†¤' }, { num: '096', name: 'ìŠ¬ë¦¬í”„' }, { num: '097', name: 'ìŠ¬ë¦¬í¼' },
                { num: '098', name: 'í¬ë©' }, { num: '099', name: 'í‚¹í¬ë©' },
                { num: '100', name: 'ì°Œë¦¬ë¦¬ê³µ' }, { num: '101', name: 'ë¶ë³¼' },
                { num: '102', name: 'ì•„ë¼ë¦¬' }, { num: '103', name: 'ë‚˜ì‹œ' },
                { num: '106', name: 'ì‹œë¼ì†Œëª¬' }, { num: '107', name: 'í™ìˆ˜ëª¬' },
                { num: '108', name: 'ë‚´ë£¸ë²¨íŠ¸' }, { num: '109', name: 'ë˜ê°€ìŠ¤' }, { num: '110', name: 'ë˜ë„ê°€ìŠ¤' },
                { num: '111', name: 'ë¿”ì¹´ë…¸' }, { num: '112', name: 'ì½”ë¿Œë¦¬' },
                { num: '113', name: 'ëŸ­í‚¤' }, { num: '114', name: 'ë©ì¿ ë¦¬' },
                { num: '115', name: 'ìº¥ì¹´' }, { num: '116', name: 'ì˜ë“œë¼' }, { num: '117', name: 'ì‹œë“œë¼' },
                { num: '118', name: 'ì½˜ì¹˜' }, { num: '119', name: 'ì™•ì½˜ì¹˜' },
                { num: '120', name: 'ë³„ê°€ì‚¬ë¦¬' }, { num: '121', name: 'ì•„ì¿ ìŠ¤íƒ€' },
                { num: '122', name: 'ë§ˆì„ë§¨' }, { num: '123', name: 'ìŠ¤ë¼í¬' },
                { num: '124', name: 'ë£¨ì£¼ë¼' }, { num: '125', name: 'ì—ë ˆí‚¤ë“œ' }, { num: '126', name: 'ë§ˆê·¸ë§ˆ' },
                { num: '127', name: 'ì˜ì‚¬ì´ì €' }, { num: '128', name: 'ì¼„íƒ€ë¡œìŠ¤' },
                { num: '129', name: 'ì‰ì–´í‚¹' }, { num: '130', name: 'ê°¸ë¼ë„ìŠ¤' },
                { num: '132', name: 'ë©”íƒ€ëª½' }, { num: '133', name: 'ì´ë¸Œì´' },
                { num: '134', name: 'ìƒ¤ë¯¸ë“œ' }, { num: '135', name: 'ì¥¬í”¼ì¬ë”' }, { num: '136', name: 'ë¶€ìŠ¤í„°' },
                { num: '137', name: 'í´ë¦¬ê³¤' }, { num: '138', name: 'ì•”ë‚˜ì´íŠ¸' }, { num: '139', name: 'ì•”ìŠ¤íƒ€' },
                { num: '140', name: 'íˆ¬êµ¬' }, { num: '141', name: 'íˆ¬êµ¬í‘¸ìŠ¤' },
                { num: '142', name: 'í”„í…Œë¼' }, { num: '147', name: 'ë¯¸ë‡¨' }, { num: '148', name: 'ì‹ ë‡¨' }, { num: '149', name: 'ë§ë‚˜ë‡½' }
            ];

            const images = pokemonData.slice(0, 50).map(pokemon => ({
                url: `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${parseInt(pokemon.num)}.png`,
                alt: pokemon.name
            }));

            displayImageGallery(images);
            console.log(`${images.length}ê°œì˜ í¬ì¼“ëª¬ ì´ë¯¸ì§€ í‘œì‹œ`);
        }

        function showSampleImages() {
            const galleryLoading = document.getElementById('galleryLoading');
            const imageGrid = document.getElementById('imageGrid');
            
            if (galleryLoading) {
                galleryLoading.style.display = 'none';
            }

            // ë‹¤ì–‘í•œ ìƒ˜í”Œ ì´ë¯¸ì§€ë“¤
            const sampleImages = [
                { url: 'https://picsum.photos/300/400?random=1', alt: 'í’ê²½ 1' },
                { url: 'https://picsum.photos/400/300?random=2', alt: 'í’ê²½ 2' },
                { url: 'https://picsum.photos/350/350?random=3', alt: 'ìì—° 1' },
                { url: 'https://picsum.photos/300/500?random=4', alt: 'ìì—° 2' },
                { url: 'https://picsum.photos/400/400?random=5', alt: 'ë„ì‹œ 1' },
                { url: 'https://picsum.photos/350/450?random=6', alt: 'ë„ì‹œ 2' },
                { url: 'https://picsum.photos/320/380?random=7', alt: 'ì¶”ìƒ 1' },
                { url: 'https://picsum.photos/380/320?random=8', alt: 'ì¶”ìƒ 2' }
            ];

            showWebWorkspace();
            displayImageGallery(sampleImages);
            console.log('ìƒ˜í”Œ ì´ë¯¸ì§€ í‘œì‹œ');
        }

        function showWebWorkspace() {
            const webWorkspace = document.getElementById('webWorkspace');
            if (webWorkspace) {
                webWorkspace.style.display = 'block';
            } else {
                console.error('webWorkspace ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        function extractImagesFromHtml(html, baseUrl) {
            // ê°„ë‹¨í•œ ì •ê·œì‹ìœ¼ë¡œ ì´ë¯¸ì§€ URL ì¶”ì¶œ
            const imgRegex = /<img[^>]+src=["']([^"']+)["'][^>]*>/gi;
            const images = [];
            let match;

            while ((match = imgRegex.exec(html)) !== null) {
                let imgUrl = match[1];
                
                // ìƒëŒ€ URLì„ ì ˆëŒ€ URLë¡œ ë³€í™˜
                if (imgUrl.startsWith('//')) {
                    imgUrl = 'https:' + imgUrl;
                } else if (imgUrl.startsWith('/')) {
                    const baseUrlObj = new URL(baseUrl);
                    imgUrl = baseUrlObj.origin + imgUrl;
                } else if (!imgUrl.startsWith('http')) {
                    const baseUrlObj = new URL(baseUrl);
                    imgUrl = new URL(imgUrl, baseUrlObj.href).href;
                }

                // ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸í•˜ê³  ì¤‘ë³µ ì œê±°
                if (isImageUrl(imgUrl) && !images.some(img => img.url === imgUrl)) {
                    images.push({
                        url: imgUrl,
                        alt: match[0].match(/alt=["']([^"']*)["']/)?.[1] || 'Image'
                    });
                }
            }

            return images.slice(0, 20); // ìµœëŒ€ 20ê°œë§Œ í‘œì‹œ
        }

        function displayImageGallery(images) {
            const imageGrid = document.getElementById('imageGrid');
            if (!imageGrid) {
                console.error('imageGrid ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            imageGrid.innerHTML = '';

            // ìµœëŒ€ 50ê°œë¡œ ì œí•œ
            const limitedImages = images.slice(0, 50);
            console.log(`í‘œì‹œí•  ì´ë¯¸ì§€ ìˆ˜: ${limitedImages.length}ê°œ (ì›ë³¸: ${images.length}ê°œ)`);

            // ì´ë¯¸ì§€ ê°œìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const imageCount = document.getElementById('imageCount');
            if (imageCount) {
                if (images.length > 50) {
                    imageCount.textContent = `${limitedImages.length}ê°œ í‘œì‹œ (ì´ ${images.length}ê°œ ì¤‘)`;
                } else {
                    imageCount.textContent = `ì´ ${limitedImages.length}ê°œ ì´ë¯¸ì§€`;
                }
            }

            limitedImages.forEach((imageInfo, index) => {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'gallery-image';
                
                const img = document.createElement('img');
                img.src = imageInfo.url;
                img.alt = imageInfo.alt;
                img.loading = 'lazy';
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'image-info';
                infoDiv.textContent = `${index + 1}`;

                img.onload = function() {
                    console.log(`ì´ë¯¸ì§€ ${index + 1} ë¡œë“œ ì™„ë£Œ`);
                };

                img.onerror = function() {
                    imageDiv.style.display = 'none';
                };

                imageDiv.addEventListener('click', () => {
                    selectGalleryImage(imageInfo.url);
                });

                imageDiv.appendChild(img);
                imageDiv.appendChild(infoDiv);
                imageGrid.appendChild(imageDiv);
            });
        }

        async function selectGalleryImage(imageUrl) {
            console.log('ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì„ íƒ:', imageUrl);
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            showImageLoadingStatus();
            hideImagePreview();
            hideConvertedResult();
            
            // ë‹¤ì–‘í•œ í”„ë¡ì‹œ ì„œë¹„ìŠ¤ë“¤ ì‹œë„
            const proxyServices = [
                'https://cors-anywhere.herokuapp.com/',
                'https://api.allorigins.win/raw?url=',
                'https://thingproxy.freeboard.io/fetch/',
                'https://cors.eu.org/',
                'https://api.codetabs.com/v1/proxy?quest='
            ];
            
            let proxyIndex = 0;
            
            function tryNextProxy() {
                if (proxyIndex < proxyServices.length) {
                    const proxyUrl = proxyServices[proxyIndex];
                    const proxiedImageUrl = proxyUrl + encodeURIComponent(imageUrl);
                    
                    console.log(`í”„ë¡ì‹œ ${proxyIndex + 1} ì‹œë„:`, proxyUrl);
                    
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)
                    const timeout = setTimeout(() => {
                        console.log(`í”„ë¡ì‹œ ${proxyIndex + 1} íƒ€ì„ì•„ì›ƒ`);
                        proxyIndex++;
                        tryNextProxy();
                    }, 10000);
                    
                    img.onload = function() {
                        clearTimeout(timeout);
                        console.log('ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ (í”„ë¡ì‹œ)');
                        currentImage = img;
                        hideImageLoadingStatus();
                        showSelectedImage(img);
                        showControls();
                    };
                    
                    img.onerror = function() {
                        clearTimeout(timeout);
                        console.log(`í”„ë¡ì‹œ ${proxyIndex + 1} ì‹¤íŒ¨, ë‹¤ìŒ ì‹œë„`);
                        proxyIndex++;
                        tryNextProxy();
                    };
                    
                    img.src = proxiedImageUrl;
                } else {
                    // ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨ ì‹œ ì§ì ‘ ë¡œë“œ ì‹œë„
                    console.log('ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨, ì§ì ‘ ë¡œë“œ ì‹œë„');
                    tryDirectImageLoad(imageUrl);
                }
            }
            
            tryNextProxy();
        }

        function tryDirectImageLoad(imageUrl) {
            console.log('ì§ì ‘ ì´ë¯¸ì§€ ë¡œë“œ ì‹œë„:', imageUrl);
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            // íƒ€ì„ì•„ì›ƒ ì„¤ì • (5ì´ˆ)
            const timeout = setTimeout(() => {
                console.log('ì§ì ‘ ë¡œë“œ íƒ€ì„ì•„ì›ƒ, ëŒ€ì²´ ì´ë¯¸ì§€ ìƒì„±');
                createFallbackImage(imageUrl);
            }, 5000);
            
            img.onload = function() {
                clearTimeout(timeout);
                console.log('ì§ì ‘ ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ');
                currentImage = img;
                hideImageLoadingStatus();
                showSelectedImage(img);
                showControls();
            };
            
            img.onerror = function() {
                clearTimeout(timeout);
                console.log('ì§ì ‘ ë¡œë“œë„ ì‹¤íŒ¨, ëŒ€ì²´ ì´ë¯¸ì§€ ìƒì„±');
                createFallbackImage(imageUrl);
            };
            
            img.src = imageUrl;
        }

        function createFallbackImage(originalUrl) {
            // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ì´ë¯¸ì§€ ìƒì„±
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 400;
            canvas.height = 400;
            
            // ë°°ê²½ìƒ‰
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, 400, 400);
            
            // í…Œë‘ë¦¬
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.strokeRect(1, 1, 398, 398);
            
            // í…ìŠ¤íŠ¸
            ctx.fillStyle = '#666';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ì´ë¯¸ì§€ í”Œë ˆì´ìŠ¤í™€ë”', 200, 180);
            ctx.fillText('ì»¬ëŸ¬ë§ë¶ìœ¼ë¡œ ë³€í™˜ ê°€ëŠ¥', 200, 210);
            
            // URL ì •ë³´
            ctx.font = '12px Arial';
            ctx.fillStyle = '#999';
            const shortUrl = originalUrl.length > 50 ? originalUrl.substring(0, 50) + '...' : originalUrl;
            ctx.fillText(shortUrl, 200, 240);
            
            // Canvasë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const img = new Image();
                
                img.onload = function() {
                    console.log('ëŒ€ì²´ ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ');
                    currentImage = img;
                    hideImageLoadingStatus();
                    showSelectedImage(img);
                    showControls();
                    alert('ì›ë³¸ ì´ë¯¸ì§€ ë¡œë“œì— ì‹¤íŒ¨í•˜ì—¬ ëŒ€ì²´ ì´ë¯¸ì§€ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.\nì»¬ëŸ¬ë§ë¶ ë³€í™˜ì€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.');
                };
                
                img.src = url;
            });
        }

        function setupSliders() {
            const threshold = document.getElementById('threshold');
            const thresholdValue = document.getElementById('thresholdValue');
            const lineWidth = document.getElementById('lineWidth');
            const lineWidthValue = document.getElementById('lineWidthValue');
            
            if (threshold && thresholdValue) {
                threshold.addEventListener('input', function() {
                    thresholdValue.textContent = this.value;
                });
            }

            if (lineWidth && lineWidthValue) {
                lineWidth.addEventListener('input', function() {
                    lineWidthValue.textContent = this.value;
                });
            }

            // ì›¹ ìŠ¬ë¼ì´ë”
            const webThreshold = document.getElementById('webThreshold');
            const webThresholdValue = document.getElementById('webThresholdValue');
            const webLineWidth = document.getElementById('webLineWidth');
            const webLineWidthValue = document.getElementById('webLineWidthValue');
            
            if (webThreshold && webThresholdValue) {
                webThreshold.addEventListener('input', function() {
                    webThresholdValue.textContent = this.value;
                });
            }
            
            if (webLineWidth && webLineWidthValue) {
                webLineWidth.addEventListener('input', function() {
                    webLineWidthValue.textContent = this.value;
                });
            }
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 10MB ì´í•˜ì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    showPreview(img);
                    showControls();
                    console.log('ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ:', file.name);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function showPreview(img) {
            const previewSection = document.getElementById('previewSection');
            const previewImage = document.getElementById('previewImage');
            
            if (previewSection && previewImage) {
                previewImage.src = img.src;
                previewSection.style.display = 'block';
                console.log('ë¯¸ë¦¬ë³´ê¸° í‘œì‹œë¨:', img.src);
            } else {
                console.error('ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        function showImageLoadingStatus() {
            const loadingStatus = document.getElementById('imageLoadingStatus');
            if (loadingStatus) {
                loadingStatus.style.display = 'block';
                console.log('ì´ë¯¸ì§€ ë¡œë”© ìƒíƒœ í‘œì‹œ');
            }
        }

        function hideImageLoadingStatus() {
            const loadingStatus = document.getElementById('imageLoadingStatus');
            if (loadingStatus) {
                loadingStatus.style.display = 'none';
                console.log('ì´ë¯¸ì§€ ë¡œë”© ìƒíƒœ ìˆ¨ê¹€');
            }
        }

        function hideImagePreview() {
            const selectedImagePreview = document.getElementById('selectedImagePreview');
            if (selectedImagePreview) {
                selectedImagePreview.style.display = 'none';
            }
        }

        function hideConvertedResult() {
            const convertedResult = document.getElementById('convertedImageResult');
            const webControlsSection = document.getElementById('webControlsSection');
            
            if (convertedResult) {
                convertedResult.style.display = 'none';
            }
            if (webControlsSection) {
                webControlsSection.style.display = 'none';
            }
        }

        function showSelectedImage(img) {
            const selectedImagePreview = document.getElementById('selectedImagePreview');
            const selectedImage = document.getElementById('selectedImage');
            const webControlsSection = document.getElementById('webControlsSection');
            
            if (selectedImagePreview && selectedImage) {
                selectedImage.src = img.src;
                selectedImagePreview.style.display = 'block';
                console.log('ì„ íƒëœ ì´ë¯¸ì§€ í‘œì‹œë¨');
            } else {
                console.error('ì„ íƒëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }

            // ì›¹ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ í‘œì‹œ
            if (webControlsSection) {
                webControlsSection.style.display = 'block';
                console.log('ì›¹ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ í‘œì‹œë¨');
            }
        }

        function showControls() {
            // í˜„ì¬ í™œì„± ëª¨ë“œ í™•ì¸
            const activeMode = document.querySelector('.mode-content.active').id;
            
            if (activeMode === 'upload-mode') {
                // íŒŒì¼ ì—…ë¡œë“œ ëª¨ë“œ: ê¸°ë³¸ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ í‘œì‹œ
                const controlsSection = document.getElementById('controlsSection');
                if (controlsSection) {
                    controlsSection.style.display = 'block';
                    console.log('íŒŒì¼ ì—…ë¡œë“œ ëª¨ë“œ: ì»¨íŠ¸ë¡¤ ì„¹ì…˜ í‘œì‹œë¨');
                } else {
                    console.error('controlsSection ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } else if (activeMode === 'web-mode') {
                // ì›¹ ì´ë¯¸ì§€ ëª¨ë“œ: ì›¹ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ì€ ì´ë¯¸ showSelectedImageì—ì„œ ì²˜ë¦¬ë¨
                console.log('ì›¹ ì´ë¯¸ì§€ ëª¨ë“œ: ì´ë¯¸ì§€ ì„ íƒ ì™„ë£Œ, ì„¤ì • í›„ ë³€í™˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”');
            }
        }

        function processWebImage() {
            if (!currentImage) {
                alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('ì›¹ ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘');

            try {
                // ì›¹ ì»¨íŠ¸ë¡¤ì—ì„œ ì„¤ì •ê°’ ê°€ì ¸ì˜¤ê¸°
                const threshold = parseInt(document.getElementById('webThreshold').value);
                const lineWidth = parseInt(document.getElementById('webLineWidth').value);
                const paperSize = document.getElementById('webPaperSize').value;
                const orientation = document.getElementById('webOrientation').value;
                const includeGuide = document.getElementById('webIncludeGuide').checked;

                console.log('ì„¤ì •ê°’:', { threshold, lineWidth, paperSize, orientation, includeGuide });

                // ì¢…ì´ ì‚¬ì´ì¦ˆì— ë§ê²Œ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
                const paper = paperSizes[paperSize];
                if (!paper) {
                    console.error('ì¢…ì´ ì‚¬ì´ì¦ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', paperSize);
                    return;
                }

                let canvasWidth, canvasHeight;
                
                if (orientation === 'landscape') {
                    canvasWidth = paper.height;
                    canvasHeight = paper.width;
                } else {
                    canvasWidth = paper.width;
                    canvasHeight = paper.height;
                }

                console.log('ìº”ë²„ìŠ¤ í¬ê¸°:', { canvasWidth, canvasHeight });

                const canvas = document.getElementById('convertedCanvas');
                if (!canvas) {
                    console.error('convertedCanvas ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                const ctx = canvas.getContext('2d');
                
                // ì´ë¯¸ì§€ ë¹„ìœ¨ì— ë§ê²Œ í¬ê¸° ì¡°ì •
                const imgRatio = currentImage.width / currentImage.height;
                const canvasRatio = canvasWidth / canvasHeight;
                
                let drawWidth, drawHeight, offsetX = 0, offsetY = 0;
                
                if (imgRatio > canvasRatio) {
                    drawWidth = canvasWidth * 0.9; // ì—¬ë°± 10%
                    drawHeight = drawWidth / imgRatio;
                    offsetY = (canvasHeight - drawHeight) / 2;
                    offsetX = canvasWidth * 0.05;
                } else {
                    drawHeight = canvasHeight * 0.9; // ì—¬ë°± 10%
                    drawWidth = drawHeight * imgRatio;
                    offsetX = (canvasWidth - drawWidth) / 2;
                    offsetY = canvasHeight * 0.05;
                }

                console.log('ì´ë¯¸ì§€ ê·¸ë¦¬ê¸° ì„¤ì •:', { drawWidth, drawHeight, offsetX, offsetY });

                canvas.width = canvasWidth;
                canvas.height = canvasHeight;

                // í°ìƒ‰ ë°°ê²½
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                console.log('ë°°ê²½ ê·¸ë¦¬ê¸° ì™„ë£Œ');

                // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                ctx.drawImage(currentImage, offsetX, offsetY, drawWidth, drawHeight);
                console.log('ì›ë³¸ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸° ì™„ë£Œ');

                // ì´ë¯¸ì§€ ì²˜ë¦¬
                const imageData = ctx.getImageData(offsetX, offsetY, drawWidth, drawHeight);
                console.log('ì´ë¯¸ì§€ ë°ì´í„° ì¶”ì¶œ ì™„ë£Œ:', imageData.width, 'x', imageData.height);
                
                const processedData = applyImageProcessing(imageData, threshold, lineWidth);
                console.log('ì´ë¯¸ì§€ ì²˜ë¦¬ ì™„ë£Œ');
                
                ctx.putImageData(processedData, offsetX, offsetY);
                console.log('ì²˜ë¦¬ëœ ì´ë¯¸ì§€ ì ìš© ì™„ë£Œ');

                // ìƒ‰ì¹  ê°€ì´ë“œ ì¶”ê°€ (ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ì‘ê²Œ í‘œì‹œ)
                if (includeGuide) {
                    addColoringGuide(ctx, canvasWidth, canvasHeight, currentImage, paper.name, orientation);
                    console.log('ìƒ‰ì¹  ê°€ì´ë“œ ì¶”ê°€ ì™„ë£Œ');
                }

                // ë³€í™˜ëœ ê²°ê³¼ í‘œì‹œ
                const resultSection = document.getElementById('convertedImageResult');
                if (resultSection) {
                    resultSection.style.display = 'block';
                    console.log('ê²°ê³¼ ì„¹ì…˜ í‘œì‹œë¨');
                    
                    // ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤
                    setTimeout(() => {
                        resultSection.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start',
                            inline: 'nearest'
                        });
                    }, 100);
                } else {
                    console.error('convertedImageResult ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                console.log('ì›¹ ì´ë¯¸ì§€ ì²˜ë¦¬ ì™„ë£Œ');
            } catch (error) {
                console.error('ì›¹ ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function processImageInWorkspace() {
            console.log('ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘');
            
            // ê¸°ë³¸ ì„¤ì •ê°’
            const threshold = 128;
            const lineWidth = 1;
            const includeGuide = false;
            
            const canvas = document.getElementById('convertedCanvas');
            const ctx = canvas.getContext('2d');
            
            // ì ë‹¹í•œ í¬ê¸°ë¡œ ì¡°ì • (400x400 ìµœëŒ€)
            const maxSize = 400;
            let canvasWidth, canvasHeight;
            
            if (currentImage.width > currentImage.height) {
                canvasWidth = Math.min(currentImage.width, maxSize);
                canvasHeight = (currentImage.height * canvasWidth) / currentImage.width;
            } else {
                canvasHeight = Math.min(currentImage.height, maxSize);
                canvasWidth = (currentImage.width * canvasHeight) / currentImage.height;
            }
            
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // í°ìƒ‰ ë°°ê²½
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.drawImage(currentImage, 0, 0, canvasWidth, canvasHeight);
            
            // ì´ë¯¸ì§€ ì²˜ë¦¬
            const imageData = ctx.getImageData(0, 0, canvasWidth, canvasHeight);
            const processedData = applyImageProcessing(imageData, threshold, lineWidth);
            
            ctx.putImageData(processedData, 0, 0);
            
            // ë³€í™˜ëœ ê²°ê³¼ í‘œì‹œ
            document.getElementById('convertedImageResult').style.display = 'block';
            console.log('ì´ë¯¸ì§€ ë³€í™˜ ì™„ë£Œ');
        }

        function processImage() {
            if (!currentImage) {
                alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘');

            const threshold = parseInt(document.getElementById('threshold').value);
            const lineWidth = parseInt(document.getElementById('lineWidth').value);
            const paperSize = document.getElementById('paperSize').value;
            const orientation = document.getElementById('orientation').value;
            const includeGuide = document.getElementById('includeGuide').checked;

            // ì¢…ì´ ì‚¬ì´ì¦ˆì— ë§ê²Œ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
            const paper = paperSizes[paperSize];
            let canvasWidth, canvasHeight;
            
            if (orientation === 'landscape') {
                canvasWidth = paper.height;
                canvasHeight = paper.width;
            } else {
                canvasWidth = paper.width;
                canvasHeight = paper.height;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // ì´ë¯¸ì§€ ë¹„ìœ¨ì— ë§ê²Œ í¬ê¸° ì¡°ì •
            const imgRatio = currentImage.width / currentImage.height;
            const canvasRatio = canvasWidth / canvasHeight;
            
            let drawWidth, drawHeight, offsetX = 0, offsetY = 0;
            
            if (imgRatio > canvasRatio) {
                drawWidth = canvasWidth * 0.9; // ì—¬ë°± 10%
                drawHeight = drawWidth / imgRatio;
                offsetY = (canvasHeight - drawHeight) / 2;
                offsetX = canvasWidth * 0.05;
            } else {
                drawHeight = canvasHeight * 0.9; // ì—¬ë°± 10%
                drawWidth = drawHeight * imgRatio;
                offsetX = (canvasWidth - drawWidth) / 2;
                offsetY = canvasHeight * 0.05;
            }

            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            // í°ìƒ‰ ë°°ê²½
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.drawImage(currentImage, offsetX, offsetY, drawWidth, drawHeight);

            // ì´ë¯¸ì§€ ì²˜ë¦¬
            const imageData = ctx.getImageData(offsetX, offsetY, drawWidth, drawHeight);
            const processedData = applyImageProcessing(imageData, threshold, lineWidth);
            
            ctx.putImageData(processedData, offsetX, offsetY);

            // ìƒ‰ì¹  ê°€ì´ë“œ ì¶”ê°€ (ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ì‘ê²Œ í‘œì‹œ)
            if (includeGuide) {
                addColoringGuide(ctx, canvasWidth, canvasHeight, currentImage, paper.name, orientation);
            }

            showResult(canvas);
            console.log('ì´ë¯¸ì§€ ì²˜ë¦¬ ì™„ë£Œ');
        }

        function applyImageProcessing(imageData, threshold, lineWidth) {
            const data = new Uint8ClampedArray(imageData.data);
            const width = imageData.width;
            const height = imageData.height;

            // ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜
            for (let i = 0; i < data.length; i += 4) {
                const gray = Math.round(0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]);
                data[i] = gray;
                data[i + 1] = gray;
                data[i + 2] = gray;
            }

            // ì—£ì§€ ê²€ì¶œ
            const output = new Uint8ClampedArray(data.length);
            
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const idx = (y * width + x) * 4;
                    
                    let gx = 0, gy = 0;
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            const pixelIdx = ((y + dy) * width + (x + dx)) * 4;
                            const intensity = data[pixelIdx];
                            
                            if (dx === -1) gx -= intensity * (dy === 0 ? 2 : 1);
                            if (dx === 1) gx += intensity * (dy === 0 ? 2 : 1);
                            if (dy === -1) gy -= intensity * (dx === 0 ? 2 : 1);
                            if (dy === 1) gy += intensity * (dx === 0 ? 2 : 1);
                        }
                    }
                    
                    const magnitude = Math.sqrt(gx * gx + gy * gy);
                    const edge = magnitude > threshold ? 0 : 255;
                    
                    output[idx] = edge;
                    output[idx + 1] = edge;
                    output[idx + 2] = edge;
                    output[idx + 3] = 255;
                }
            }

            // ì„  êµµê¸° ì ìš©
            if (lineWidth > 1) {
                const thickened = new Uint8ClampedArray(output.length);
                for (let i = 0; i < thickened.length; i++) {
                    thickened[i] = 255;
                }
                thickened[thickened.length - 1] = 255; // Alpha

                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const idx = (y * width + x) * 4;
                        
                        if (output[idx] === 0) {
                            for (let dy = -lineWidth; dy <= lineWidth; dy++) {
                                for (let dx = -lineWidth; dx <= lineWidth; dx++) {
                                    const newX = x + dx;
                                    const newY = y + dy;
                                    
                                    if (newX >= 0 && newX < width && newY >= 0 && newY < height) {
                                        if (dx * dx + dy * dy <= lineWidth * lineWidth) {
                                            const newIdx = (newY * width + newX) * 4;
                                            thickened[newIdx] = 0;
                                            thickened[newIdx + 1] = 0;
                                            thickened[newIdx + 2] = 0;
                                            thickened[newIdx + 3] = 255;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return new ImageData(thickened, width, height);
            }

            return new ImageData(output, width, height);
        }

        function addColoringGuide(ctx, width, height, originalImage, paperName, orientation) {
            // ìƒ‰ì¹  ê°€ì´ë“œ í¬ê¸° ì„¤ì • (ì „ì²´ í¬ê¸°ì˜ 1/4 ì •ë„)
            const guideSize = Math.min(width, height) * 0.25;
            const guideWidth = guideSize;
            const guideHeight = guideSize * (originalImage.height / originalImage.width);
            
            // ìš°ì¸¡ ìƒë‹¨ì— ìœ„ì¹˜
            const guideX = width - guideWidth - 20;
            const guideY = 20;
            
            // ê°€ì´ë“œ ë°°ê²½ (í°ìƒ‰)
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(guideX - 5, guideY - 5, guideWidth + 10, guideHeight + 35);
            
            // ê°€ì´ë“œ í…Œë‘ë¦¬
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.strokeRect(guideX - 5, guideY - 5, guideWidth + 10, guideHeight + 35);
            
            // ì›ë³¸ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸° (ìƒ‰ì¹  ê°€ì´ë“œ)
            ctx.drawImage(originalImage, guideX, guideY, guideWidth, guideHeight);
            
            // ì´ë¯¸ì§€ í…Œë‘ë¦¬
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.strokeRect(guideX, guideY, guideWidth, guideHeight);
            
            // ê°€ì´ë“œ ë ˆì´ë¸”
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ìƒ‰ì¹  ê°€ì´ë“œ', guideX + guideWidth / 2, guideY + guideHeight + 20);
            
            // ì¢…ì´ ì •ë³´ (ì¢Œì¸¡ í•˜ë‹¨)
            ctx.fillStyle = '#666';
            ctx.font = '10px Arial';
            ctx.textAlign = 'left';
            const infoText = `${paperName} | ${orientation === 'portrait' ? 'ì„¸ë¡œ' : 'ê°€ë¡œ'} | ${new Date().toLocaleDateString('ko-KR')}`;
            ctx.fillText(infoText, 20, height - 10);
            
            // ë„¤ ëª¨ì„œë¦¬ì— ìë¥´ê¸° ê°€ì´ë“œ
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 1;
            const markSize = 10;
            const margin = 5;
            
            [[margin, margin], [width - margin, margin], [margin, height - margin], [width - margin, height - margin]].forEach(([x, y]) => {
                ctx.beginPath();
                ctx.moveTo(x - markSize, y);
                ctx.lineTo(x + markSize, y);
                ctx.moveTo(x, y - markSize);
                ctx.lineTo(x, y + markSize);
                ctx.stroke();
            });
            
            // í…ìŠ¤íŠ¸ ì •ë ¬ ì´ˆê¸°í™”
            ctx.textAlign = 'left';
        }

        function showResult(canvas) {
            const resultSection = document.getElementById('resultSection');
            const resultCanvas = document.getElementById('resultCanvas');
            
            resultCanvas.width = canvas.width;
            resultCanvas.height = canvas.height;
            const ctx = resultCanvas.getContext('2d');
            ctx.drawImage(canvas, 0, 0);
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function downloadResult() {
            const canvas = document.getElementById('resultCanvas');
            if (!canvas) {
                alert('ì²˜ë¦¬ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const paperSize = document.getElementById('paperSize').value;
            const orientation = document.getElementById('orientation').value;
            const link = document.createElement('a');
            link.download = `coloring-book-${paperSize}-${orientation}-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            console.log('ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
        }

        function resetApp() {
            currentImage = null;
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('controlsSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('fileInput').value = '';
            console.log('ì•± ë¦¬ì…‹ ì™„ë£Œ');
        }

        console.log('ì•± ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>